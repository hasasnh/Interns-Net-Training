@model Ejada_Portal.Models.ResetPasswordViewModel

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Reset Password";
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Reset Password</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Global Styles -->
    <link href="~/assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
</head>
<body data-kt-name="metronic" id="kt_body" class="app-blank app-blank bgi-size-cover bgi-position-center bgi-no-repeat">
    <script>
        // Theme mode
        if (document.documentElement) {
            const defaultThemeMode = "system";
            const name = document.body.getAttribute("data-kt-name");
            let themeMode = localStorage.getItem("kt_" + (name ? name + "_" : "") + "theme_mode_value");
            if (themeMode === null) {
                themeMode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
            }
            document.documentElement.setAttribute("data-theme", themeMode);
        }
    </script>

    <div class="d-flex flex-column flex-root" id="kt_app_root">
        <style>
            body {
                background-image: url('@Url.Content("~/assets/media/auth/bg10.jpeg")');
            }

            [data-theme="dark"] body {
                background-image: url('@Url.Content("~/assets/media/auth/bg10-dark.jpeg")');
            }
        </style>

        <div class="d-flex flex-column flex-lg-row flex-column-fluid">
            <!-- Aside -->
            <div class="d-flex flex-lg-row-fluid">
                <div class="d-flex flex-column flex-center pb-0 pb-lg-10 p-10 w-100">
                    <img class="theme-light-show mx-auto mw-100 w-150px w-lg-300px mb-10 mb-lg-20" src="~/assets/media/auth/agency.png" alt="" />
                    <img class="theme-dark-show  mx-auto mw-100 w-150px w-lg-300px mb-10 mb-lg-20" src="~/assets/media/auth/agency-dark.png" alt="" />
                    <h1 class="text-gray-800 fs-2qx fw-bold text-center mb-7">Set a New Password</h1>
                    <div class="text-gray-600 fs-base text-center fw-semibold">Use 8+ chars with letters, numbers &amp; symbols.</div>
                </div>
            </div>
            <!-- Card -->
            <div class="d-flex flex-column-fluid flex-lg-row-auto justify-content-center justify-content-lg-end p-12">
                <div class="bg-body d-flex flex-center rounded-4 w-md-600px p-10">
                    <div class="w-md-400px">
                        <!-- Form -->
                        <form asp-action="ResetPassword" asp-controller="User" method="post" id="kt_new_password_form" class="form w-100" novalidate>
                            @Html.AntiForgeryToken()

                            <!-- Hidden -->
                            <input asp-for="Email" type="hidden" />
                            <input asp-for="Token" type="hidden" />

                            <div class="text-center mb-10">
                                <h1 class="text-dark fw-bolder mb-3">Setup New Password</h1>
                                <div class="text-gray-500 fw-semibold fs-6">
                                    Have you already reset the password ?
                                    <a href="#" class="link-primary fw-bold">Sign in</a>
                                    <div>
                                    </div>
                                </div>
                            </div>

                            <!-- Password -->
                            <div class="fv-row mb-8" data-kt-password-meter="true">
                                <div class="mb-1">
                                    <div class="position-relative mb-3">
                                        <input asp-for="Password" class="form-control bg-transparent" type="password" placeholder="Enter the new Password" autocomplete="off" />
                                        <span class="btn btn-sm btn-icon position-absolute translate-middle top-50 end-0 me-n2" data-kt-password-meter-control="visibility">
                                            <i class="bi bi-eye-slash fs-2"></i>
                                            <i class="bi bi-eye fs-2 d-none"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="text-muted">Use 8 or more characters with a mix of letters, numbers &amp; symbols.</div>
                                <span asp-validation-for="Password" class="text-danger"></span>
                            </div>

                            <!-- Confirm -->
                            <div class="fv-row mb-8">
                                <input asp-for="ConfirmPassword" class="form-control bg-transparent" type="password" placeholder="Repeat Password" autocomplete="off" />
                                <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                            </div>

                            <div class="d-grid mb-10">
                                <button type="submit" id="kt_new_password_submit" class="btn btn-primary">
                                    <span class="indicator-label">Submit</span>
                                    <span class="indicator-progress">
                                        Please wait...
                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                    </span>
                                    <a asp-action="Login"></a>
                                </button>
                            </div>
                        </form>
                        <!-- /Form -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Scripts -->
    <script src="~/assets/plugins/global/plugins.bundle.js"></script>
    <script src="~/assets/js/scripts.bundle.js"></script>
    @* لا تضمّن سكربت الصفحة الخاص بمترو***نيك لأنه غالبًا يمنع الإرسال العادي *@
    @* <script src="~/assets/js/custom/authentication/password-reset/new-password.js"></script> *@

    <!-- alert() للتحقق والرسائل -->
    <script>
        (function () {
            // تحقق عميل: تطابق كلمتي المرور قبل الإرسال
            const form = document.getElementById('kt_new_password_form');
            if (form) {
                form.addEventListener('submit', function (e) {
                    const pwd = form.querySelector('input[name="Password"]');
                    const cpw = form.querySelector('input[name="ConfirmPassword"]');
                    if (pwd && cpw && pwd.value !== cpw.value) {
                        e.preventDefault();
                        e.stopPropagation();
                        alert('The passwords you entered do not match. Please try again.');
                        cpw.focus();
                        return false;
                    }
                }, true);
            }
        })();
    </script>

    @{
        var serverErrors = ViewData.ModelState.Values
        .SelectMany(v => v.Errors)
        .Select(e => e.ErrorMessage)
        .Where(m => !string.IsNullOrWhiteSpace(m))
        .ToList();

        string alertMsg = "";
        if (serverErrors.Any())
        {
            // جهّز النص لحقنه في جافاسكربت
            alertMsg = string.Join("\\n", serverErrors)
            .Replace("\\", "\\\\")
            .Replace("'", "\\'")
            .Replace("\r", "")
            .Replace("\n", "\\n");
        }
    }
    @if (!string.IsNullOrEmpty(alertMsg))
    {
        <script>
            alert('@alertMsg');
        </script>
    }

    <!-- jQuery -->
    <partial name="_ValidationScriptsPartial" />
</body>
</html>
