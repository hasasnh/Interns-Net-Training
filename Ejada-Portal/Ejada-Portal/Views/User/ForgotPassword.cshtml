@model Ejada_Portal.Models.ForgotPasswordViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Forgot Password";
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Forgot Password</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Global Styles -->
    <link href="~/assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
</head>
<body data-kt-name="metronic" id="kt_body" class="app-blank app-blank bgi-size-cover bgi-position-center bgi-no-repeat">
    <script>
        if (document.documentElement) {
            const defaultThemeMode = "system";
            const name = document.body.getAttribute("data-kt-name");
            let themeMode = localStorage.getItem("kt_" + (name ? name + "_" : "") + "theme_mode_value");
            if (themeMode === null) {
                themeMode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
            }
            document.documentElement.setAttribute("data-theme", themeMode);
        }
    </script>

    <div class="d-flex flex-column flex-root" id="kt_app_root">
        <style>
            body {
                background-image: url('@Url.Content("~/assets/media/auth/bg10.jpeg")');
            }

            [data-theme="dark"] body {
                background-image: url('@Url.Content("~/assets/media/auth/bg10-dark.jpeg")');
            }
        </style>

        <div class="d-flex flex-column flex-lg-row flex-column-fluid">
            <!-- Aside -->
            <div class="d-flex flex-lg-row-fluid">
                <div class="d-flex flex-column flex-center pb-0 pb-lg-10 p-10 w-100">
                    <img class="theme-light-show mx-auto mw-100 w-150px w-lg-300px mb-10 mb-lg-20" src="~/assets/media/auth/agency.png" alt="" />
                    <img class="theme-dark-show  mx-auto mw-100 w-150px w-lg-300px mb-10 mb-lg-20" src="~/assets/media/auth/agency-dark.png" alt="" />
                    <h1 class="text-gray-800 fs-2qx fw-bold text-center mb-7">Fast, Efficient and Productive</h1>
                    <div class="text-gray-600 fs-base text-center fw-semibold">
                        In this kind of post, <a href="#" class="opacity-75-hover text-primary me-1">the blogger</a> introduces a person…
                    </div>
                </div>
            </div>

            <!-- Card -->
            <div class="d-flex flex-column-fluid flex-lg-row-auto justify-content-center justify-content-lg-end p-12">
                <div class="bg-body d-flex flex-center rounded-4 w-md-600px p-10">
                    <div class="w-md-400px">
                        <!-- Form -->
                        <form asp-action="ForgotPassword" asp-controller="User" method="post" class="form w-100" novalidate>
                            @Html.AntiForgeryToken()

                            <div class="text-center mb-10">
                                <h1 class="text-dark fw-bolder mb-3">Forgot Password ?</h1>
                                <div class="text-gray-500 fw-semibold fs-6">Enter your email to reset your password.</div>
                            </div>

                            <div class="fv-row mb-8">
                                <input asp-for="Email" type="email" placeholder="Email" class="form-control bg-transparent" autocomplete="off" />
                                <span asp-validation-for="Email" class="text-danger"></span>
                            </div>

                            <div class="d-flex flex-wrap justify-content-center pb-lg-0">
                                <button type="submit" id="kt_password_reset_submit" class="btn btn-primary me-4">
                                    <span class="indicator-label">Submit</span>
                                    <span class="indicator-progress">
                                        Please wait...
                                        <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                                    </span>
                                </button>
                                <a asp-controller="User" asp-action="Login" class="btn btn-light">Cancel</a>
                            </div>
                        </form>
                        <!-- /Form -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Scripts -->
    <script src="~/assets/plugins/global/plugins.bundle.js"></script>
    <script src="~/assets/js/scripts.bundle.js"></script>
    @* <script src="~/assets/js/custom/authentication/reset-password/reset-password.js"></script> *@

    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    @* نجاح: تم إرسال رابط إعادة التعيين *@
    @if (TempData["MailSent"] is string mailMsg)
    {
        <script>Swal.fire({ icon: 'success', title: 'تم', text: 'A Password reset link has been sent to your email.' });</script>
    }

    @if (TempData["PasswordChanged"] is string pwdMsg)
    {
        <script>Swal.fire({ icon: 'success', title: 'تم', text: 'Your password has been changed successfully' });</script>
    }

    @{
        string emailError = null;
        if (!ViewData.ModelState.IsValid && ViewData.ModelState.ContainsKey(nameof(Ejada_Portal.Models.ForgotPasswordViewModel.Email)))
        {
            var errs = ViewData.ModelState[nameof(Ejada_Portal.Models.ForgotPasswordViewModel.Email)]?.Errors;
            if (errs?.Count > 0) { emailError = errs[0].ErrorMessage; }
        }
    }
    @if (!string.IsNullOrEmpty(emailError))
    {
        <script>Swal.fire({ icon: 'error', title: 'خطأ', text: 'The email you entered does not exist in the system, try again' });</script>
    }

    <partial name="_ValidationScriptsPartial" />
</body>
</html>
